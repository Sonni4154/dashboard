# 🚀 Quick Fix for Items ID

**Run these commands on your server:**

```bash
cd /opt/dashboard/backend

# Check the current id column setup
cat > check-and-fix-items-id.mjs << 'EOF'
import 'dotenv/config';
import { neon } from '@neondatabase/serverless';

const sql = neon(process.env.DATABASE_URL);

async function fixItemsId() {
  try {
    console.log('🔍 Checking items.id column...');
    
    const check = await sql`
      SELECT is_identity, identity_generation, column_default
      FROM information_schema.columns
      WHERE table_schema = 'quickbooks' 
      AND table_name = 'items'
      AND column_name = 'id';
    `;
    
    console.log('Current setup:', check[0]);
    
    if (check[0].is_identity === 'NO') {
      console.log('\n🔧 Fixing: Making id auto-generate...');
      
      // Drop existing constraint if any
      await sql`
        ALTER TABLE quickbooks.items 
        ALTER COLUMN id DROP DEFAULT;
      `;
      
      // Make it identity
      await sql`
        ALTER TABLE quickbooks.items 
        ALTER COLUMN id 
        ADD GENERATED BY DEFAULT AS IDENTITY;
      `;
      
      console.log('✅ Fixed! Now id will auto-generate.');
    } else {
      console.log('✅ Already set to auto-generate!');
    }
    
  } catch (error) {
    console.error('❌ Error:', error);
    console.log('\n💡 Trying alternative approach...');
    
    try {
      await sql`
        CREATE SEQUENCE IF NOT EXISTS quickbooks.items_id_seq;
      `;
      
      await sql`
        ALTER TABLE quickbooks.items 
        ALTER COLUMN id 
        SET DEFAULT nextval('quickbooks.items_id_seq');
      `;
      
      console.log('✅ Fixed using sequence!');
    } catch (err2) {
      console.error('❌ Alternative also failed:', err2);
    }
  }
}

fixItemsId();
EOF

node check-and-fix-items-id.mjs

# Restart and test
pm2 restart all
sleep 5
curl -X POST http://localhost:5000/api/sync
```

---

**This will:**
1. Check if `id` is set to auto-generate
2. If not, fix it to use `GENERATED BY DEFAULT AS IDENTITY`
3. If that fails, create a sequence instead
4. Test the sync again

---

**Run it now!** 🚀

