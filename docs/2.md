# ‚òÅÔ∏è Cloudflare Deployment Guide for QuickBooks Dashboard Backend

This guide covers the steps to deploy and secure your **QuickBooks Dashboard backend** using **Cloudflare**, including DNS setup, SSL configuration, and Cloudflare Worker routing.

---

## 1Ô∏è‚É£ DNS Configuration

### Steps:
1. Log in to your **Cloudflare Dashboard** ‚Üí select your domain (e.g., `wemakemarin.com`).
2. Navigate to **DNS ‚Üí Records**.
3. Add the following:

| Type | Name | Content | Proxy Status | TTL |
|------|------|----------|---------------|------|
| A | `dashboard` | `<your_server_public_IP>` | **Proxied** ‚òÅÔ∏è | Auto |
| A | `api` | `<your_server_public_IP>` | **Proxied** ‚òÅÔ∏è | Auto |
| CNAME | `www` | `wemakemarin.com` | **Proxied** ‚òÅÔ∏è | Auto |

> üí° Proxied mode enables Cloudflare security, caching, and SSL termination.

After DNS propagates (usually within 5‚Äì10 minutes), you‚Äôll be able to access:
```
https://dashboard.wemakemarin.com
https://api.wemakemarin.com
```

---

## 2Ô∏è‚É£ SSL Configuration

### Option A: Use **Certbot + Nginx** (Recommended)

On your server (Ubuntu/Debian):
```bash
sudo apt update && sudo apt install certbot python3-certbot-nginx -y
sudo certbot --nginx -d dashboard.wemakemarin.com -d api.wemakemarin.com
```

Certbot will automatically configure SSL in your Nginx server blocks and renew certificates every 90 days.

### Option B: Use **Cloudflare Origin Certificate** (For internal edge SSL)
1. In Cloudflare ‚Üí **SSL/TLS ‚Üí Origin Server** ‚Üí click **Create Certificate**.
2. Choose:
   - Private key type: RSA (2048-bit)
   - Hostnames: `*.wemakemarin.com, wemakemarin.com`
3. Save both **certificate** and **private key** to your server:
   ```bash
   sudo nano /etc/ssl/certs/cloudflare-origin.pem
   sudo nano /etc/ssl/private/cloudflare-origin.key
   ```
4. Update Nginx site config to use these certs:
   ```nginx
   ssl_certificate /etc/ssl/certs/cloudflare-origin.pem;
   ssl_certificate_key /etc/ssl/private/cloudflare-origin.key;
   ```

5. In Cloudflare ‚Üí **SSL/TLS ‚Üí Overview**, set SSL mode to **Full (strict)**.

---

## 3Ô∏è‚É£ Nginx Configuration for Backend

Create or edit `/etc/nginx/sites-available/dashboard.conf`:

```nginx
server {
  listen 80;
  server_name dashboard.wemakemarin.com api.wemakemarin.com;
  return 301 https://$host$request_uri;
}

server {
  listen 443 ssl http2;
  server_name dashboard.wemakemarin.com api.wemakemarin.com;

  ssl_certificate /etc/letsencrypt/live/wemakemarin.com/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/wemakemarin.com/privkey.pem;

  location / {
    proxy_pass http://127.0.0.1:5000;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection 'upgrade';
    proxy_set_header Host $host;
    proxy_cache_bypass $http_upgrade;
  }
}
```

Enable the site and reload Nginx:
```bash
sudo ln -s /etc/nginx/sites-available/dashboard.conf /etc/nginx/sites-enabled/
sudo nginx -t && sudo systemctl reload nginx
```

---

## 4Ô∏è‚É£ Cloudflare Workers (Optional Edge Caching & Routing)

Workers let you route specific paths or apply caching rules.

Example worker script:
```js
export default {
  async fetch(request) {
    const url = new URL(request.url);

    if (url.pathname.startsWith('/api/')) {
      url.hostname = 'api.wemakemarin.com';
      return fetch(url, request);
    }

    // Cache dashboard frontend at the edge
    if (url.pathname.startsWith('/dashboard')) {
      return fetch('https://dashboard.wemakemarin.com', request, {
        cf: { cacheEverything: true, cacheTtl: 3600 }
      });
    }

    return fetch(request);
  }
};
```
Deploy the worker in **Cloudflare ‚Üí Workers & Pages ‚Üí Create Worker**, then assign routes:
```
*wemakemarin.com/api/* ‚Üí [api-worker]
*wemakemarin.com/dashboard/* ‚Üí [dashboard-worker]
```

---

## 5Ô∏è‚É£ Firewall, Security, and Performance

- Enable **Bot Fight Mode** under **Security ‚Üí Bots**.
- Enable **DDoS Protection** and **WAF managed rules**.
- Under **Caching ‚Üí Configuration**, set:
  - Caching level: **Standard**
  - Always Online: **On**
  - Development Mode: **Off**
- Optionally enable **Argo Smart Routing** for faster API responses.

---

## ‚úÖ Summary

- ‚úÖ DNS records set for dashboard + API subdomains.
- ‚úÖ HTTPS secured with Certbot or Cloudflare Origin Certificates.
- ‚úÖ Nginx reverse proxy forwarding to local backend.
- ‚úÖ Optional Cloudflare Worker for caching and edge routing.

Next: I can generate a **GitHub Actions CI/CD pipeline** guide to automatically deploy backend updates to your server and trigger Cloudflare cache purges.

